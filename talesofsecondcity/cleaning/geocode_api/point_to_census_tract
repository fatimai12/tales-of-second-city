"""
CAPP 30122
Team: Tales of Second City
Author: Fatima Irfan

Map point data file rows to corresponding census tracts
"""

from geopy.geocoders import Nominatim
import pandas as pd
import geopandas as gpd
from pygris.geocode import geolookup

geolocator = Nominatim(user_agent="talesofsecondcity")
census_tracts = gpd.read_file("../data/original/Boundaries - Census Tracts - 2010.geojson")
l_stops_df = pd.read_csv("../data/original/CTA_-_System_Information_-_List_of__L__Stops_-_Map.csv")

def geocode_l_stops(df):
    """
    """
    for row in l_stops_df.itertuples():
        lat, long = row.Location.strip("()").split(",")
        geocoded_addr = geolookup(longitude = long, latitude = lat, 
                                geography = "Census Tracts", keep_geo_cols = True)
        tract = str(geocoded_addr["TRACT"].to_string(index = False))
        l_stops_df.at[row.Index, "tract"] = tract
    
    return l_stops_df

l_stops_geocode = geocode_l_stops(l_stops_df)

l_stops_geocode.to_csv("../../data/transformed/l_stops_geocoded.csv", index = False)